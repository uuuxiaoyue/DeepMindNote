<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.Menu?>
<?import javafx.scene.control.MenuBar?>
<?import javafx.scene.control.MenuItem?>
<?import javafx.scene.control.RadioMenuItem?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.SeparatorMenuItem?>
<?import javafx.scene.control.SplitPane?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.ToggleButton?>
<?import javafx.scene.control.ToggleGroup?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.control.TreeView?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.SVGPath?>
<?import javafx.scene.web.WebView?>

<VBox fx:id="rootContainer" prefHeight="700.0" prefWidth="1100.0" stylesheets="@../css/style.css" xmlns="http://javafx.com/javafx/24.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.deepmind.controller.MainController">

    <HBox alignment="CENTER_LEFT" spacing="10" styleClass="top-bar">

        <Separator orientation="VERTICAL" />

        <MenuBar fx:id="mainMenuBar" style="-fx-background-color: transparent;" styleClass="menu-bar">
            <menus>
                <Menu text="æ–‡ä»¶(F)">
                    <items>
                        <MenuItem accelerator="Ctrl+N" onAction="#handleNewNote" text="æ–°å»º" />
                        <MenuItem accelerator="Ctrl+Shift+N" onAction="#handleNewWindow" text="æ–°å»ºçª—å£" />
                        <SeparatorMenuItem />

                        <MenuItem accelerator="Ctrl+O" onAction="#handleOpenFile" text="æ‰“å¼€..." />
                        <MenuItem onAction="#handleOpenFolder" text="æ‰“å¼€æ–‡ä»¶å¤¹..." />
                        <SeparatorMenuItem />

                        <MenuItem accelerator="Ctrl+P" onAction="#handleQuickOpen" text="å¿«é€Ÿæ‰“å¼€..." />
                        <Menu fx:id="recentFilesMenu" text="æ‰“å¼€æœ€è¿‘æ–‡ä»¶" /> <SeparatorMenuItem />

                        <MenuItem accelerator="Ctrl+S" onAction="#handleSave" text="ä¿å­˜" />
                        <MenuItem accelerator="Ctrl+Shift+S" onAction="#handleSaveAs" text="å¦å­˜ä¸º..." />
                        <MenuItem onAction="#handleSave" text="ä¿å­˜å…¨éƒ¨æ‰“å¼€çš„æ–‡ä»¶..." /> <SeparatorMenuItem />

                        <MenuItem onAction="#handleShowProperties" text="å±žæ€§..." />
                        <MenuItem onAction="#handleOpenFolder" text="æ‰“å¼€æ–‡ä»¶ä½ç½®..." />
                        <MenuItem onAction="#handleDelete" text="åˆ é™¤..." />
                        <SeparatorMenuItem />

                        <MenuItem accelerator="Ctrl+I" onAction="#handleImport" text="å¯¼å…¥..." />
                        <Menu text="å¯¼å‡º">
                            <items>
                                <MenuItem onAction="#handleExportMarkdown" text="Markdown (.md)" />
                                <MenuItem onAction="#handleExportPDF" text="PDF æ–‡æ¡£ (.pdf)" />
                                <MenuItem onAction="#handleExportWord" text="Word æ–‡æ¡£ (.docx)" />
                                <SeparatorMenuItem />
                                <MenuItem onAction="#handleExportHTMLFull" text="ç½‘é¡µ (å¸¦æ ·å¼ .html)" />
                                <MenuItem onAction="#handleExportHTMLRaw" text="ç½‘é¡µ (çº¯å‡€ç‰ˆ .html)" />
                                <SeparatorMenuItem />
                                <MenuItem onAction="#handleExportImage" text="é•¿å›¾åˆ†äº« (.png)" />
                            </items>
                        </Menu>

                        <MenuItem accelerator="Alt+Shift+P" onAction="#handlePrint" text="æ‰“å°..." />
                        <SeparatorMenuItem />

                        <MenuItem accelerator="Ctrl+," text="åå¥½è®¾ç½®..." />
                        <SeparatorMenuItem />

                        <MenuItem accelerator="Ctrl+W" onAction="#handleClose" text="å…³é—­" />
                    </items>
                </Menu>
                <Menu text="ç¼–è¾‘(E)">
                    <items>
                        <MenuItem accelerator="Ctrl+Z" onAction="#handleUndo" text="æ’¤é”€" />
                        <MenuItem accelerator="Ctrl+Y" onAction="#handleRedo" text="é‡åš" />
                        <SeparatorMenuItem />
                        <MenuItem accelerator="Ctrl+X" onAction="#handleCut" text="å‰ªåˆ‡" />
                        <MenuItem accelerator="Ctrl+C" onAction="#handleCopy" text="å¤åˆ¶" />
                        <MenuItem accelerator="Ctrl+V" onAction="#handlePaste" text="ç²˜è´´" />
                        <SeparatorMenuItem />
                        <MenuItem accelerator="Ctrl+F" onAction="#handleFind" text="æŸ¥æ‰¾" />
                        <MenuItem accelerator="Ctrl+H" onAction="#handleReplace" text="æ›¿æ¢" />
                    </items>
                </Menu>

                <Menu text="æ®µè½(P)">
                    <items>
                        <MenuItem accelerator="Ctrl+U" onAction="#handleUnorderedList" text="æ— åºåˆ—è¡¨" />
                        <MenuItem accelerator="Ctrl+O" onAction="#handleOrderedList" text="æœ‰åºåˆ—è¡¨" />
<!--                        <MenuItem text="ä»»åŠ¡åˆ—è¡¨" onAction="#handleTaskList" accelerator="Ctrl+T"/>-->
                        <SeparatorMenuItem />
                        <Menu text="æ ‡é¢˜çº§åˆ«">
                            <items>
                                <MenuItem accelerator="Ctrl+1" onAction="#handleH1" text="ä¸€çº§æ ‡é¢˜ (H1)" />
                                <MenuItem accelerator="Ctrl+2" onAction="#handleH2" text="äºŒçº§æ ‡é¢˜ (H2)" />
                                <MenuItem accelerator="Ctrl+3" onAction="#handleH3" text="ä¸‰çº§æ ‡é¢˜ (H3)" />
                                <MenuItem accelerator="Ctrl+4" onAction="#handleH4" text="å››çº§æ ‡é¢˜ (H4)" />
                                <MenuItem accelerator="Ctrl+5" onAction="#handleH5" text="äº”çº§æ ‡é¢˜ (H5)" />
                                <MenuItem accelerator="Ctrl+6" onAction="#handleH6" text="å…­çº§æ ‡é¢˜ (H6)" />
                            </items>
                        </Menu>
                        <SeparatorMenuItem />
                        <MenuItem accelerator="Ctrl+Q" onAction="#handleBlockquote" text="å¼•ç”¨å—" />
                    </items>
                </Menu>

                <Menu text="æ ¼å¼(O)">
                    <items>
                        <MenuItem accelerator="Ctrl+B" onAction="#handleBold" text="åŠ ç²—" />
                        <MenuItem accelerator="Ctrl+I" onAction="#handleItalic" text="å€¾æ–œ" />
                        <MenuItem accelerator="Ctrl+D" onAction="#handleStrikethrough" text="åˆ é™¤çº¿" />
                        <MenuItem accelerator="Ctrl+H" onAction="#handleHighlight" text="é«˜äº®" />
                    </items>
                </Menu>

                <Menu text="è§†å›¾(V)">
                    <items>
                        <MenuItem onAction="#handleEditMode" text="æºä»£ç æ¨¡å¼" />
                        <MenuItem onAction="#handlePreviewMode" text="é¢„è§ˆæ¨¡å¼" />
                        <SeparatorMenuItem />
                        <MenuItem onAction="#handleToggleSidebar" text="æ˜¾ç¤º/éšè—ä¾§è¾¹æ " />
                        <MenuItem onAction="#toggleOutline" text="æ˜¾ç¤º/éšè—å¤§çº²" />
                    </items>
                </Menu>
                <Menu text="ä¸»é¢˜(T)">
                    <items>
                        <RadioMenuItem onAction="#handleThemeMenuAction" selected="true" text="é»˜è®¤è“">
                            <toggleGroup><ToggleGroup fx:id="themeGroup" /></toggleGroup>
                        </RadioMenuItem>
                        <RadioMenuItem onAction="#handleThemeMenuAction" text="æš—å¤œé»‘" toggleGroup="$themeGroup" />
                        <RadioMenuItem onAction="#handleThemeMenuAction" text="æ£®ç³»ç»¿" toggleGroup="$themeGroup" />
                        <RadioMenuItem onAction="#handleThemeMenuAction" text="æš–é˜³æ©™" toggleGroup="$themeGroup" />
                    </items>
                </Menu>
                <Menu text="å¸®åŠ©(H)">
                    <items><MenuItem text="å…³äºŽ" /></items>
                </Menu>
            </menus>
        </MenuBar>

    </HBox>


    <SplitPane fx:id="splitPane" dividerPositions="0.2, 0.8" style="-fx-background-color: -color-bg-base;" VBox.vgrow="ALWAYS">
        <items>
            <VBox fx:id="sidebarContainer" maxWidth="400" minWidth="0" spacing="10" styleClass="sidebar">
                <padding><Insets bottom="10" left="10" right="10" top="10" /></padding>

                <HBox alignment="CENTER_RIGHT" spacing="5">
                    <Region HBox.hgrow="ALWAYS" />

                    <Button onAction="#handleNewNote" styleClass="icon-btn-small">
                        <tooltip><Tooltip text="æ–°å»ºç¬”è®°" /></tooltip>
                        <graphic>
                            <javafx.scene.shape.SVGPath content="M14 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h10zm0 2H4v12h10V6z M11 8l-4 4 4 4" fill="#6c757d" scaleX="0.8" scaleY="0.8" />
                            <javafx.scene.shape.SVGPath content="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" fill="#6c757d" scaleX="0.7" scaleY="0.7" />
                        </graphic>
                    </Button>

                    <Button onAction="#handleNewFolder" styleClass="icon-btn-small">
                        <tooltip><Tooltip text="æ–°å»ºåˆ†ç±»æ–‡ä»¶å¤¹" /></tooltip>
                        <graphic>
                            <javafx.scene.shape.SVGPath content="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z M15 14h-2v2h-2v-2H9v-2h2v-2h2v2h2v2z" fill="#6c757d" scaleX="0.7" scaleY="0.7" />
                        </graphic>
                    </Button>
                </HBox>

                <TextField fx:id="searchField" promptText="ðŸ” æœç´¢ç¬”è®°..." />

                <TreeView fx:id="fileTree" showRoot="false" VBox.vgrow="ALWAYS" />
            </VBox>

            <VBox spacing="10" style="-fx-background-color: -color-bg-base;">
                <StackPane VBox.vgrow="ALWAYS">
                    <TextArea fx:id="editorArea" managed="false" visible="false" wrapText="true" />
                    <WebView fx:id="webView" managed="true" visible="true" />

                    <VBox fx:id="findReplacePane" managed="false" maxHeight="110" maxWidth="350" style="-fx-background-color: white; -fx-background-radius: 8; -fx-border-color: #ddd; -fx-border-radius: 8; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.15), 10, 0, 0, 5); -fx-padding: 10;" visible="false" StackPane.alignment="TOP_RIGHT">

                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <TextField fx:id="findInputField" promptText="æŸ¥æ‰¾..." style="-fx-background-color: #f4f4f4; -fx-border-radius: 4;" HBox.hgrow="ALWAYS" />
                            <Button onAction="#findNext" styleClass="status-btn" text="â†“" />
                            <Button onAction="#closeFindPane" style="-fx-background-color: transparent; -fx-text-fill: #999; -fx-cursor: hand;" text="âœ•" />
                        </HBox>

                        <HBox fx:id="replaceBox" alignment="CENTER_LEFT" spacing="8" style="-fx-padding: 8 0 0 0;">
                            <TextField fx:id="replaceInputField" promptText="æ›¿æ¢ä¸º..." style="-fx-background-color: #f4f4f4; -fx-border-radius: 4;" HBox.hgrow="ALWAYS" />
                            <Button onAction="#handleReplaceSingle" style="-fx-font-size: 11px;" styleClass="status-btn" text="æ›¿æ¢" />
                            <Button onAction="#handleReplaceAll" style="-fx-font-size: 11px;" styleClass="status-btn" text="å…¨éƒ¨" />
                        </HBox>
                    </VBox>
                </StackPane>

                <HBox alignment="CENTER_LEFT" spacing="10" styleClass="status-bar">
                    <Label fx:id="wordCountLabel" styleClass="text-muted" text="å­—æ•°: 0" />

                    <Region HBox.hgrow="ALWAYS" />
               <ToggleButton fx:id="btnToggleSidebar" onAction="#handleToggleSidebar" selected="true" styleClass="icon-button">
                  <tooltip>
                     <Tooltip text="æ˜¾ç¤º/éšè—ä¾§è¾¹æ " />
                  </tooltip>
                  <graphic>
                     <SVGPath content="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z M9 4v16" fill="TRANSPARENT" stroke="#a3a3a3" styleClass="svg-path" />
                  </graphic>
               </ToggleButton>

                    <Button onAction="#handleEditMode" styleClass="status-btn" text="&lt;/&gt;">
                        <tooltip><Tooltip text="å¯ç”¨æºä»£ç æ¨¡å¼" /></tooltip>
                    </Button>

                    <Button onAction="#toggleOutline" styleClass="status-btn">
                        <tooltip><Tooltip text="å±•å¼€/å…³é—­å¤§çº²æ " /></tooltip>
                  <graphic>
                     <SVGPath content="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z M15 4v16" fill="TRANSPARENT" stroke="#a3a3a3" />
                  </graphic>
                    </Button>


                </HBox>
            </VBox>

            <VBox fx:id="outlineContainer" maxWidth="250" minWidth="0" spacing="10" styleClass="sidebar">
                <padding><Insets bottom="10" left="10" right="10" top="10" /></padding>
                <Label style="-fx-font-weight:bold" text="æ–‡ç« å¤§çº²" />
                <ListView fx:id="outlineListView" VBox.vgrow="ALWAYS" />
            </VBox>
        </items>
    </SplitPane>

</VBox>
